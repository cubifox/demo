---
layout: default
title: "方式設計書"
description: "TODO APPの方式設計書 - システム設計・API設計・セキュリティ・デプロイ"
---

# TODO APP 方式設計書

## 目次

1. [システム概要](#システム概要)
2. [システム構成](#システム構成)
3. [アーキテクチャ設計](#アーキテクチャ設計)
4. [データベース設計](#データベース設計)
5. [API設計](#API設計)
6. [インターフェース設計](#インターフェース設計)
7. [セキュリティ設計](#セキュリティ設計)
8. [デプロイ構成](#デプロイ構成)

---

## システム概要

### 概要
TODO APPは、Next.js 15.5.2とReactを基盤とするシングルページアプリケーション（SPA）です。クライアントサイドでの完結したタスク管理システムとして設計され、ローカルストレージを使用してデータを永続化します。

### 技術選定理由
- **Next.js**: React基盤のフルスタックフレームワーク、SSR/SSG対応
- **TypeScript**: 型安全性による開発効率とバグ削減
- **Tailwind CSS**: ユーティリティファーストによる高速スタイリング
- **Local Storage**: サーバーレス環境での簡易データ永続化

### システム特性
- **パフォーマンス**: クライアントサイド処理による高速レスポンス
- **可用性**: オフライン動作可能（初回ロード後）
- **拡張性**: コンポーネントベース設計による機能追加容易性
- **保守性**: TypeScriptによる型安全性とコード品質

---

## システム構成

### 論理構成図

```mermaid
graph TB
    subgraph "ユーザー環境"
        User[ユーザー]
        Browser[ブラウザ]
    end
    
    subgraph "フロントエンド層"
        NextJS[Next.js_Application]
        React[React_Components]
        StateManager[State_Management]
        LocalStorage[Local_Storage]
    end
    
    subgraph "スタイリング層"
        TailwindCSS[Tailwind_CSS]
        ResponsiveDesign[Responsive_Design]
    end
    
    subgraph "ホスティング環境"
        Vercel[Vercel_Platform]
        CDN[Global_CDN]
        EdgeNetwork[Edge_Network]
    end
    
    User --> Browser
    Browser --> NextJS
    NextJS --> React
    React --> StateManager
    StateManager --> LocalStorage
    NextJS --> TailwindCSS
    TailwindCSS --> ResponsiveDesign
    
    Vercel --> CDN
    CDN --> EdgeNetwork
    EdgeNetwork --> Browser
```

### 物理構成図

```mermaid
graph LR
    subgraph "開発環境"
        DevMachine[開発マシン]
        VSCode[VS_Code]
        Git[Git_Repository]
    end
    
    subgraph "CI/CD"
        GitHub[GitHub_Repository]
        VercelCI[Vercel_CI_CD]
    end
    
    subgraph "本番環境"
        VercelEdge[Vercel_Edge_Functions]
        GlobalCDN[Global_CDN]
        UserBrowser[User_Browser]
    end
    
    DevMachine --> VSCode
    VSCode --> Git
    Git --> GitHub
    GitHub --> VercelCI
    VercelCI --> VercelEdge
    VercelEdge --> GlobalCDN
    GlobalCDN --> UserBrowser
```

---

## アーキテクチャ設計

### レイヤー構成

```mermaid
graph TD
    subgraph "プレゼンテーション層"
        UI[UI_Components]
        Pages[Pages]
        Layouts[Layouts]
    end
    
    subgraph "ビジネスロジック層"
        Hooks[Custom_Hooks]
        Utils[Utility_Functions]
        Validators[Validation_Logic]
    end
    
    subgraph "データアクセス層"
        StateManagement[State_Management]
        StorageAPI[Storage_API]
        DataModels[Data_Models]
    end
    
    subgraph "インフラストラクチャ層"
        NextJS_Framework[Next.js_Framework]
        React_Runtime[React_Runtime]
        Browser_APIs[Browser_APIs]
    end
    
    UI --> Hooks
    Pages --> UI
    Layouts --> Pages
    Hooks --> Utils
    Utils --> Validators
    Hooks --> StateManagement
    StateManagement --> StorageAPI
    StorageAPI --> DataModels
    StateManagement --> NextJS_Framework
    StorageAPI --> Browser_APIs
    NextJS_Framework --> React_Runtime
```

### コンポーネント設計

```mermaid
graph TB
    subgraph "Page_Level"
        TodoApp[TodoApp_Main_Page]
    end
    
    subgraph "Container_Components"
        TaskFormContainer[TaskForm_Container]
        TaskListContainer[TaskList_Container]
        HeaderContainer[Header_Container]
    end
    
    subgraph "UI_Components"
        TaskForm[Task_Form]
        TaskItem[Task_Item]
        CategorySelect[Category_Select]
        PrioritySelect[Priority_Select]
        DateInput[Date_Input]
        Button[Button_Component]
    end
    
    subgraph "Hooks"
        useTasks[useTasks_Hook]
        useLocalStorage[useLocalStorage_Hook]
        useForm[useForm_Hook]
    end
    
    TodoApp --> TaskFormContainer
    TodoApp --> TaskListContainer
    TodoApp --> HeaderContainer
    
    TaskFormContainer --> TaskForm
    TaskListContainer --> TaskItem
    TaskForm --> CategorySelect
    TaskForm --> PrioritySelect
    TaskForm --> DateInput
    TaskForm --> Button
    
    TaskFormContainer --> useTasks
    TaskListContainer --> useTasks
    useTasks --> useLocalStorage
    TaskFormContainer --> useForm
```

---

## データベース設計

### データモデル

```mermaid
erDiagram
    Task {
        number id PK
        string title
        string description
        string category
        string priority
        string deadline
        boolean completed
        date created_at
        date updated_at
    }
    
    Category {
        string value PK
        string label
        string color
        number sort_order
    }
    
    Priority {
        string level PK
        number weight
        string color
        string icon
    }
    
    Task ||--|| Category : belongs_to
    Task ||--|| Priority : has
```

### TypeScript型定義

```typescript
// 基本データ型
type Priority = "高" | "中" | "低";
type Category = "仕事" | "プライベート" | "その他";

// メインタスク型
interface Task {
  id: number;
  title: string;
  description: string;
  category: Category;
  priority: Priority;
  deadline: string;
  completed: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// カテゴリ設定型
interface CategoryConfig {
  value: Category;
  label: string;
  color: string;
  sortOrder: number;
}

// 優先度設定型
interface PriorityConfig {
  level: Priority;
  weight: number;
  color: string;
  icon: string;
}

// フォーム型
interface TaskFormData {
  title: string;
  description: string;
  category: Category;
  priority: Priority;
  deadline: string;
}

// ストレージ型
interface StorageData {
  tasks: Task[];
  settings: AppSettings;
  version: string;
}
```

### ローカルストレージ設計

```mermaid
graph LR
    subgraph "LocalStorage_Structure"
        TodoAppData[todo_app_data]
        TasksArray[tasks_array]
        Settings[app_settings]
        Metadata[metadata]
    end
    
    subgraph "Data_Management"
        SaveOperation[Save_Operation]
        LoadOperation[Load_Operation]
        MigrationLogic[Migration_Logic]
        ErrorHandling[Error_Handling]
    end
    
    TodoAppData --> TasksArray
    TodoAppData --> Settings
    TodoAppData --> Metadata
    
    SaveOperation --> TodoAppData
    LoadOperation --> TodoAppData
    MigrationLogic --> TodoAppData
    ErrorHandling --> SaveOperation
    ErrorHandling --> LoadOperation
```

---

## API設計

### 内部API設計（フロントエンド）

```mermaid
graph TB
    subgraph "TaskAPI_Interface"
        CreateTask[createTask]
        UpdateTask[updateTask]
        DeleteTask[deleteTask]
        GetTasks[getTasks]
        ToggleComplete[toggleComplete]
    end
    
    subgraph "StorageAPI_Interface"
        SaveToStorage[saveToStorage]
        LoadFromStorage[loadFromStorage]
        ClearStorage[clearStorage]
        MigrateData[migrateData]
    end
    
    subgraph "ValidationAPI_Interface"
        ValidateTask[validateTask]
        ValidateForm[validateForm]
        SanitizeInput[sanitizeInput]
    end
    
    CreateTask --> ValidateTask
    UpdateTask --> ValidateTask
    ValidateTask --> SanitizeInput
    CreateTask --> SaveToStorage
    UpdateTask --> SaveToStorage
    DeleteTask --> SaveToStorage
    GetTasks --> LoadFromStorage
    ToggleComplete --> SaveToStorage
```

### API関数仕様

```typescript
// タスク管理API
interface TaskAPI {
  // タスク作成
  createTask(taskData: TaskFormData): Promise<Task>;
  
  // タスク更新
  updateTask(id: number, updates: Partial<Task>): Promise<Task>;
  
  // タスク削除
  deleteTask(id: number): Promise<void>;
  
  // タスク取得
  getTasks(): Promise<Task[]>;
  
  // 完了状態切り替え
  toggleComplete(id: number): Promise<Task>;
  
  // フィルタリング
  getTasksByCategory(category: Category): Promise<Task[]>;
  getTasksByPriority(priority: Priority): Promise<Task[]>;
  getCompletedTasks(): Promise<Task[]>;
  getPendingTasks(): Promise<Task[]>;
}

// ストレージAPI
interface StorageAPI {
  save<T>(key: string, data: T): Promise<void>;
  load<T>(key: string): Promise<T | null>;
  remove(key: string): Promise<void>;
  clear(): Promise<void>;
  exists(key: string): Promise<boolean>;
  getSize(): Promise<number>;
}

// バリデーションAPI
interface ValidationAPI {
  validateTask(task: TaskFormData): ValidationResult;
  validateTitle(title: string): boolean;
  validateDeadline(deadline: string): boolean;
  sanitizeInput(input: string): string;
}
```

---

## インターフェース設計

### ユーザーインターフェース設計

```mermaid
graph TB
    subgraph "Main_Layout"
        Header[App_Header]
        MainContent[Main_Content]
        Footer[App_Footer]
    end
    
    subgraph "Task_Creation_Area"
        TaskForm[Task_Form]
        TitleInput[Title_Input]
        DescriptionInput[Description_Input]
        CategorySelector[Category_Selector]
        PrioritySelector[Priority_Selector]
        DeadlineInput[Deadline_Input]
        SubmitButton[Submit_Button]
    end
    
    subgraph "Task_Display_Area"
        TaskList[Task_List]
        TaskItem[Task_Item]
        FilterOptions[Filter_Options]
        SortOptions[Sort_Options]
    end
    
    subgraph "Task_Actions"
        CompleteToggle[Complete_Toggle]
        EditButton[Edit_Button]
        DeleteButton[Delete_Button]
    end
    
    Header --> MainContent
    MainContent --> TaskForm
    MainContent --> TaskList
    
    TaskForm --> TitleInput
    TaskForm --> DescriptionInput
    TaskForm --> CategorySelector
    TaskForm --> PrioritySelector
    TaskForm --> DeadlineInput
    TaskForm --> SubmitButton
    
    TaskList --> TaskItem
    TaskList --> FilterOptions
    TaskList --> SortOptions
    
    TaskItem --> CompleteToggle
    TaskItem --> EditButton
    TaskItem --> DeleteButton
```

### レスポンシブデザイン

```mermaid
graph LR
    subgraph "Desktop_Layout"
        DesktopGrid[Grid_Layout]
        DesktopForm[Form_Sidebar]
        DesktopList[List_Main_Area]
    end
    
    subgraph "Tablet_Layout"
        TabletStack[Stack_Layout]
        TabletForm[Form_Top]
        TabletList[List_Bottom]
    end
    
    subgraph "Mobile_Layout"
        MobileStack[Vertical_Stack]
        MobileForm[Compact_Form]
        MobileList[Scrollable_List]
    end
    
    DesktopGrid --> DesktopForm
    DesktopGrid --> DesktopList
    
    TabletStack --> TabletForm
    TabletStack --> TabletList
    
    MobileStack --> MobileForm
    MobileStack --> MobileList
```

---

## セキュリティ設計

### セキュリティ対策

```mermaid
graph TB
    subgraph "Input_Security"
        InputValidation[入力検証]
        InputSanitization[入力無害化]
        XSSPrevention[XSS対策]
    end
    
    subgraph "Data_Security"
        LocalStorageEncryption[ローカルストレージ暗号化]
        DataValidation[データ検証]
        IntegrityCheck[整合性チェック]
    end
    
    subgraph "Client_Security"
        CSPHeaders[CSP_Headers]
        HTTPSOnly[HTTPS_Only]
        SecureCookies[Secure_Cookies]
    end
    
    subgraph "Code_Security"
        DependencyScanning[依存関係スキャン]
        StaticAnalysis[静的解析]
        VulnerabilityCheck[脆弱性チェック]
    end
    
    InputValidation --> InputSanitization
    InputSanitization --> XSSPrevention
    
    LocalStorageEncryption --> DataValidation
    DataValidation --> IntegrityCheck
    
    CSPHeaders --> HTTPSOnly
    HTTPSOnly --> SecureCookies
    
    DependencyScanning --> StaticAnalysis
    StaticAnalysis --> VulnerabilityCheck
```

### セキュリティ実装

```typescript
// 入力検証・無害化
class SecurityUtils {
  static validateInput(input: string): boolean {
    // 入力値の妥当性検証
    return /^[a-zA-Z0-9\s\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]*$/.test(input);
  }
  
  static sanitizeInput(input: string): string {
    // HTMLエスケープ
    return input
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#x27;');
  }
  
  static validateTaskData(task: TaskFormData): ValidationResult {
    const errors: string[] = [];
    
    if (!this.validateInput(task.title)) {
      errors.push('不正な文字が含まれています');
    }
    
    if (task.title.length > 100) {
      errors.push('タイトルが長すぎます');
    }
    
    return {
      isValid: errors.length === 0,
      errors
    };
  }
}

// CSP設定（next.config.js）
const cspHeader = `
  default-src 'self';
  script-src 'self' 'unsafe-eval' 'unsafe-inline';
  style-src 'self' 'unsafe-inline';
  img-src 'self' blob: data:;
  font-src 'self';
  object-src 'none';
  base-uri 'self';
  form-action 'self';
  frame-ancestors 'none';
  upgrade-insecure-requests;
`;
```

---

## デプロイ構成

### デプロイメントフロー

```mermaid
graph LR
    subgraph "開発フェーズ"
        LocalDev[ローカル開発]
        Testing[テスト実行]
        CodeReview[コードレビュー]
    end
    
    subgraph "CI_CD_Pipeline"
        GitCommit[Git_Commit]
        GitHubActions[GitHub_Actions]
        BuildProcess[ビルドプロセス]
        QualityCheck[品質チェック]
    end
    
    subgraph "デプロイメント"
        VercelDeploy[Vercel_Deploy]
        ProductionTest[本番テスト]
        Monitoring[監視開始]
    end
    
    LocalDev --> Testing
    Testing --> CodeReview
    CodeReview --> GitCommit
    
    GitCommit --> GitHubActions
    GitHubActions --> BuildProcess
    BuildProcess --> QualityCheck
    
    QualityCheck --> VercelDeploy
    VercelDeploy --> ProductionTest
    ProductionTest --> Monitoring
```

### 環境構成

```mermaid
graph TB
    subgraph "開発環境"
        DevEnv[Development]
        LocalServer[localhost:3000]
        HotReload[Hot_Reload]
    end
    
    subgraph "ステージング環境"
        StagingEnv[Staging]
        StagingURL[staging-url.vercel.app]
        FeatureTest[機能テスト]
    end
    
    subgraph "本番環境"
        ProdEnv[Production]
        CustomDomain[custom-domain.com]
        CDN[Global_CDN]
        Analytics[Analytics]
    end
    
    DevEnv --> StagingEnv
    StagingEnv --> ProdEnv
    
    LocalServer --> HotReload
    StagingURL --> FeatureTest
    CustomDomain --> CDN
    CDN --> Analytics
```

### ビルド・デプロイ設定

```typescript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  trailingSlash: true,
  images: {
    unoptimized: true
  },
  env: {
    APP_VERSION: process.env.npm_package_version,
    BUILD_TIME: new Date().toISOString(),
  },
  headers: async () => [
    {
      source: '/(.*)',
      headers: [
        {
          key: 'X-Content-Type-Options',
          value: 'nosniff',
        },
        {
          key: 'X-Frame-Options',
          value: 'DENY',
        },
        {
          key: 'X-XSS-Protection',
          value: '1; mode=block',
        },
      ],
    },
  ],
};

module.exports = nextConfig;

// vercel.json
{
  "buildCommand": "npm run build",
  "outputDirectory": "out",
  "framework": "nextjs",
  "functions": {},
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

### 監視・運用

```mermaid
graph TB
    subgraph "監視項目"
        Performance[パフォーマンス監視]
        ErrorTracking[エラー追跡]
        UserAnalytics[ユーザー分析]
        UptimeMonitoring[稼働監視]
    end
    
    subgraph "監視ツール"
        VercelAnalytics[Vercel_Analytics]
        GoogleAnalytics[Google_Analytics]
        Lighthouse[Lighthouse_CI]
        ErrorBoundary[Error_Boundary]
    end
    
    subgraph "運用対応"
        AlertSystem[アラートシステム]
        LogAnalysis[ログ分析]
        PerformanceTuning[パフォーマンスチューニング]
        SecurityUpdate[セキュリティ更新]
    end
    
    Performance --> VercelAnalytics
    ErrorTracking --> ErrorBoundary
    UserAnalytics --> GoogleAnalytics
    UptimeMonitoring --> Lighthouse
    
    VercelAnalytics --> AlertSystem
    ErrorBoundary --> LogAnalysis
    GoogleAnalytics --> PerformanceTuning
    Lighthouse --> SecurityUpdate
```
